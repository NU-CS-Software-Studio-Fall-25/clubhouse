<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <%= form_with(model: event, class: "card shadow-sm") do |form| %>
        <div class="card-body">
          <%= form.hidden_field :club_id, value: event.club_id || params[:club_id] %>

          <div class="mb-3">
            <%= form.label :name, class: "form-label" %>
            <%= form.text_field :name, class: "form-control" %>
          </div>

          <div class="mb-3">
            <%= form.label :date, class: "form-label" %>
            <%= form.datetime_field :date, class: "form-control" %>
          </div>

          <div class="mb-3">
            <%= form.label :location, class: "form-label" %>
            <%= form.text_field :location, class: "form-control" %>
          </div>

          <div class="mb-3">
            <%= form.label :description, class: "form-label" %>
            <%= form.text_area :description, class: "form-control", rows: 4, id: "event_description" %>
            <div class="form-text">Optional: provide details about the event. <span id="char-count">0</span>/750 characters</div>
          </div>

          <div class="mb-3">
            <div class="form-check">
              <%= form.check_box :recurring, class: "form-check-input", id: "event_recurring" %>
              <%= form.label :recurring, "Recurring weekly", class: "form-check-label" %>
            </div>
          </div>

          <div class="mb-3 d-none" id="event_end_date_field">
            <%= form.label :end_date, "End Date", class: "form-label" %>
            <%= form.date_field :end_date, class: "form-control" %>
            <div class="form-text">Events will be created weekly until this date</div>
          </div>

          <div class="d-grid">
            <%= form.submit class: "btn btn-primary", id: "event_submit" %>
          </div>

          <script>
            (() => {
              const MAX_CHARS = 750;
              const WARNING_CHARS = 700;
              const descriptionField = document.getElementById('event_description');
              const charCount = document.getElementById('char-count');
              const submitBtn = document.getElementById('event_submit');
              const recurringCheckbox = document.getElementById('event_recurring');
              const endDateField = document.getElementById('event_end_date_field');

              const toggleEndDateField = () => {
                if (recurringCheckbox && endDateField) {
                  endDateField.classList.toggle('d-none', !recurringCheckbox.checked);
                }
              };

              const updateCharCount = () => {
                const length = descriptionField.value.length;
                charCount.textContent = length;

                // Update outline color based on character count
                if (length > MAX_CHARS) {
                  descriptionField.style.borderColor = '#dc3545'; // red
                  descriptionField.style.borderWidth = '2px';
                  submitBtn.disabled = true;
                } else if (length > WARNING_CHARS) {
                  descriptionField.style.borderColor = '#ffc107'; // yellow
                  descriptionField.style.borderWidth = '2px';
                  submitBtn.disabled = false;
                } else {
                  descriptionField.style.borderColor = '';
                  descriptionField.style.borderWidth = '';
                  submitBtn.disabled = false;
                }
              };

              // Initial setup
              toggleEndDateField();
              updateCharCount();

              // Add event listeners
              recurringCheckbox?.addEventListener('change', toggleEndDateField);
              descriptionField?.addEventListener('input', updateCharCount);
            })();
          </script>
        </div>
      <% end %>
    </div>
  </div>
</div>
  